# BESSPIN CI & Test Environment

### FUNCTIONALITY IS NOT YET LIVE. DOCUMENT IS SOLELY INFORMATIONAL UNTIL TOOL SUITE BETA 1.0.

### Galois will provide to TA-1 Teams:
- Team-specific forks of the GFE, Tool Suite, and Testgen GitLab repositories
  - These will all be identical at first, and based on the latest current release versions.
  - Teams are encouraged to customize these repos in whatever way makes their report generation workflow easiest for them.
	- The difference (git diff) between the initial and final states of these repos will be available as an evaluation artifact, along with test and PPA scores.
- A CI environment consisting of:
	- GitLab CI pipelines that will trigger runs when commits are made to GFE or Tool Suite forks.
	- “Runners” (FPGAs connected to host machines) to perform CI. TA-1 teams will not have direct access to Galois-hosted FPGA resources; they need to use Gitlab CI.
- Report output generated by CI:
	- GFE baseline test suite results: ISA, I/O peripherals, OS boots. These will be reported by GFE CI. They are expected to pass for a given processor bitstream before running security tests on that processor.
	- Power, Performance and Area (PPA) results. These will be reported by Tool Suite CI, based on Vivado's utilization reports generated during bitstream synthesis and the Coremark and Mibench benchmark suites included in both GFE and Tool Suite. 
	- Security evaluation results. These are reported by Testgen tools as part of Tool Suite CI.

### TA-1 Team Workflow
1. Configure the GFE repository fork 
	- Use the GFE fork to provide custom bitstreams and toolchains
	- Note: commits to the GFE fork will trigger CI
		- GFE CI will generate reports on PPA, ISA tests, and OS boot confirmation
2. Configure the Testgen and Tool Suite repository forks
	- Testgen:
		- Add customized test .ini files to the “CI Configurations” directory, which determine the test environment (processor, OS, compilers, CWE tests)
		- To use custom OS images see documentation [HERE](https://gitlab-ext.galois.com/ssith/tool-suite/blob/develop/doc/howto_testingCustomProcessor.md#os-images)
		- See documentation on [“Testing a Custom Processor”](https://gitlab-ext.galois.com/ssith/testgen#testing-custom-processor) for additional detail
		- Commits to Testgen **will not** trigger CI (for CI, commit to Tool Suite repo, updating nix/besspin/testgen-src.nix as needed)
	- Tool Suite
		- See documentation on [“How to Test a Custom Processor”](https://gitlab-ext.galois.com/ssith/tool-suite/blob/develop/doc/howto_testingCustomProcessor.md) to adapt Tool Suite to your team’s needs
		- Commits to Tool Suite **will** trigger CI
			- Tool Suite CI includes GFE, Testgen, and Tool Suite custom builds, tests, and reports
3. Let CI run following commits to GFE or Tool Suite
4. Review GitLab CI logs

### CI Process Diagram
![fig:ciDiagram](doc/doc-images/ci-diagram.png "CI Diagram")
