{ stdenv, fetchGit2, pandoc, texliveEnv }:

stdenv.mkDerivation rec {
  name = "poc-exploits";

  src = fetchGit2 {
    url = "git@gitlab-ext.galois.com:ssith/poc-exploits.git";
    rev = "dcd8feacaa6991e52a5d124624353166f9ebad73";
  };

  buildInputs = [ pandoc texliveEnv ];

  buildPhase = ''
    make -C buffer_errors/heartbleed
    make -C information_leakage
  '';

  installPhase = ''
    mkdir -p $out/buffer_errors_heartbleed
    cp -r buffer_errors/heartbleed/{*.pdf,sample_exploit_code} \
      $out/buffer_errors_heartbleed

    mkdir -p $out/information_leakage
    cp -r information_leakage/{*.pdf,sample_exploit_code} \
      $out/information_leakage
  '';
}
